## CP Model Outline

##### Nomenclature
- "(original) periodic task": refers to a periodic task from which multiple instances can be derived. 
- "periodic task instance": a task that originates from a periodic task.

##### Necessary information for the CP Model to function. The following parameters need to exist before the CP Model generation starts.
- All task instances including instances of periodic tasks up to the Scheduling Limit (no new tasks can be generated by the CP Model)
- The number of resources
- Periodicity and period length of all tasks
- The Scheduling Limit (for periodic tasks sets, this is the hyperperiod)
- Precedence Relations between tasks (represented as predecessor and successor lists within each task)
- Resource identifiers for residency constrained tasks

##### CP-Model-Tasks: The tasks as represented in the Model.
- Integer Variable - start: The time at which the task is started to be scheduled
- Integer Variable - end: The time at which the scheduled task is finished
- Integer Variable - resource: The resource on which the task is scheduled
- Integer Variable - wcet: The computation time / worst-case-execution-time of the task
- Interval Variable - interval: The Interval of [start,end]. Its length is equal to the wcet variable.

##### Dynamic Constraints: Task bounds dynamically generated by the CP Model.
- Integer Variable - Minimum ReleaseTime: [0,limit]
- Integer Variable - Maximum ReleaseTime: [0,limit]
- Integer Variable - Minimum Deadline: [0,limit]
- Integer Variable - Maximum Deadline: [0,limit]
- Integer Variable - Minimum WCET: [1,limit]
- Integer Variable - Maximum WCET: [1,limit]
- The exact domains are calculated depending on the user input regarding minimum and maximum releaseTimes, deadlines and wcet.


##### Task Constraints:
- The resource variable is either equal to the resource ID the task is constrained to, or within [0, num_resources-1]
- The end variable must be equal to start + WCET. This is enforced for all tasks.
- The start variable of all model-tasks must be within [Minimum ReleaseTime, Maximum ReleaseTime]
- The wcet variable of all model tasks must be within [Minimum WCET, Maximum WCET]
- The end variable of all model-tasks must be within [Minimum Deadline, Maximum Deadline]
- For task instances of periodic tasks:
  - The start variable must have the same offset relative to the start of the task period as the original periodic task has (enforces equal releaseTimes for periodic task instances)
  - The end variable must have the same offset relative to the end of the task period as the original periodic task has (enforces equal deadlines for periodic task instances)
  - All periodic task instances have equal WCET to the task they originate from, and must be scheduled on the same resource
- For periodic tasks:
  - Period-start = PeriodLength * (Instance Number+1)
  - Period-end = PeriodLength * Instance Number
  - The domain of the end variable is [periodStart+1,periodEnd]
  - The domain of the start variable is [periodStart,periodEnd-1]
  - The domains are adjusted depending on the user input regarding minimum and maximum releaseTimes, deadlines and wcet.

##### Precedence Constraints:
- For every precedence relation defined within the tasks “Predecessors” attribute, a GreaterOrEqual relation is added between the start variable of the successor and the end variable of the predecessor.

##### Residency Constraints:
- Since residency constraints are calculated before generating the model, we simply assign the domain of the resource IntVar to the resource the task has to be computed on.
- If multiple residency constraints have been set, we enforce that the resource IntVar of the task cannot be equal to the resources the task cannot be scheduled on.

##### Phased ReleaseTimes:
- Phased ReleaseTimes can only occur once before the scheduling of a periodic task. They are not releasetimes in the usual sense, as they do not occur for periodic task instances of the periodic task. They are meant to represent the "startup time" of the periodic task.
- Since we need to calculate the periods and the scheduling limit before we generate our CP-Model, we can only support phased releasetimes that are a multiple of the tasks period. This is necessary since we require the existence of a hyperperiod.
- If a task has a phased releasetime, the start and end IntVars have the domain [releasetime, releasetime + period]. The domains for periodic task instances are adjusted as well.

##### Hints:
- Hints are values for specific Integer Variables that the solver uses in order to find a solution. Hints are not constraints themselves, and may be disregarded in the solution.
- Task-WCET:
  - If the task is periodic, and the original task instance, we hint at a random WCET value with the bounds [1,PeriodLength]
  - For periodic task instances, we do not hint at a random WCET value since our model enforces that all instances of a periodic task have the same WCET.
  - If the task is not periodic, we hint at a random WCET value with the bounds [1, SchedulingLimit * #Resources / #tasks]
- Task-Resource:
  - For each task, we hint at a random value within the bounds [0,num_resources-1]


##### Solver Settings:
- Randomized Fixed Search (solver.getPrameters().setRandomizeSearch(true)):
  - Seems to affect which values are selected for each variable during the solution process 
- No Model Presolve (solver.getParameters().setCpModelPresolve(false):
  - Prevents the solver from pre-solving the model, thus increasing the amount of possible solutions
- Enumerate all Solutions (solver.getParameters().setEnumerateAllSolutions(true)):
  - Enumerates every solution found by the solver
  - Enables returning after the solver has found the first solution

 